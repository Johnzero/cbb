<!-- Javascript -->
<script src="__ROOT__/statics/js/sweetalert/sweet-alert.min.js"></script>
<link rel="stylesheet" href="__ROOT__/statics/js/sweetalert/sweet-alert.css">
<script src="__ROOT__/statics/js/angular/angular.js"></script>
<script src="__ROOT__/statics/js/angular/angular-animate.js"></script>
<script src="__ROOT__/statics/js/angular/angular-ui-router.js"></script>
<script src="__ROOT__/statics/js/angular/loading-bar.js"></script>
<link href='__ROOT__/statics/js/angular/loading-bar.css' rel='stylesheet' />
<script type="text/javascript">
	var cultural = angular.module('cultural', ['ui.router','angular-loading-bar','ngAnimate']);
	
	cultural.config(function(cfpLoadingBarProvider,$stateProvider, $urlRouterProvider,$locationProvider,$httpProvider) {
		// $urlRouterProvider

		// .otherwise(function($injector, $location){
		// 	$injector.invoke(['$state', function($state) {
		// 		// window.location = $location['$$absUrl'];
		// 	}]);
		// });
		// $urlRouterProvider.otherwise('/');

		$stateProvider
		.state("/", {
			url: "/",
			templateUrl: "/"
		})
		.state("search", {
			url: "/search/:keyword",
			templateUrl: function ($stateParams){
				if ($stateParams.keyword) {
					return '/search/index.html?keyword=' + $stateParams.keyword;
				}
				else {
					return "/";
				}
			}
		})
		.state("user", {
			url: "/user/:actionName/:tplName.html",
			templateUrl: function ($stateParams){
				return '/user/' + $stateParams.actionName + '/' + $stateParams.tplName + '.html';
			}
		})
		.state("list", {
			url: "/list/index/id/:listId.html",
			templateUrl: function ($stateParams){
				return '/list/index/id/' + $stateParams.listId + '.html';
			}
		})
		.state("article", {
			url: "/article/index/id/:articleId.html",
			templateUrl: function ($stateParams){
			return '/article/index/id/' + $stateParams.articleId + '.html';
			}
		})
		.state("comment", {
			url: "/comment/comment/:tplName.html",
			templateUrl: function ($stateParams){
			return '/comment/comment/' + $stateParams.tplName + '.html';
			}
		})
		cfpLoadingBarProvider.includeSpinner = true;
		$locationProvider.html5Mode(true);
		$httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';
		$httpProvider.defaults.headers.common['X-Requested-With'] = 'application/angularjs';
		
	})
	
	cultural.controller('searchCtl', function ($scope, $state, $location) {
		// $location.path('/').replace();
		$scope.onSearchSubmit = function() {
			$state.go("search", {keyword: $scope.searchForm.keyword}, {reload:true,inherit:true});
		}
	});

	cultural.controller('loginCtl', function ($scope, $state, $http) {
		$scope.onloginSubmit = function($event) {
			if ( !$scope.loginForm ) {
				sweetAlert("登陆错误！", "请填写内容!", "error");
				return;
			}else if ( !$scope.loginForm.username ) {
				sweetAlert("登陆错误！", "请填写用户名!", "error");
				return;
			}else if ( !$scope.loginForm.password ) {
				sweetAlert("登陆错误！", "请输入密码!", "error");
				return;
			}else if ( !$scope.loginForm.password ) {
				sweetAlert("登陆错误！", "请输入密码!", "error");
				return;
			}else if ( !$scope.loginForm.password ) {
				sweetAlert("登陆错误！", "请同意网站内容服务条款!", "error");
				return;
			}

			$http({
				method  : 'POST',
				url     : "{:u('user/login/dologin')}",
				data    : $.param($scope.loginForm),  // pass in data as strings
				headers : { 'Content-Type': 'application/x-www-form-urlencoded' }
			})
			.success(function(data) {

				sweetAlert(data.info, data.data, data.status);
				if ( data.status == "success") {
					location.href = data.referer;
				}
			})
			.error( function () {
				sweetAlert("登陆错误！", "网络异常，请稍后重试！","error");
			});

			$event.preventDefault();
		}
	});
		
	</script>
	<script type="text/javascript">
	$(function(){
		$('body').on('touchstart.dropdown', '.dropdown-menu', function (e) { e.stopPropagation(); });
		
		;(function($){
			$.fn.totop=function(opt){
				var scrolling=false;
				return this.each(function(){
					var $this=$(this);
					$(window).scroll(function(){
						if(!scrolling){
							var sd=$(window).scrollTop();
							if(sd>100){
								$this.fadeIn();
							}else{
								$this.fadeOut();
							}
						}
					});
					
					$this.click(function(){
						scrolling=true;
						$('html, body').animate({
							scrollTop : 0
						}, 500,function(){
							scrolling=false;
							$this.fadeOut();
						});
					});
				});
			};
		})(jQuery);
		
		$("#backtotop").totop();
		
	});
	</script>