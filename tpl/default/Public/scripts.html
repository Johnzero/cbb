<!-- Javascript -->
<script src="__ROOT__/statics/js/angular/angular.js"></script>
<script src="__ROOT__/statics/js/angular/angular-animate.js"></script>
<script src="__ROOT__/statics/js/angular/angular-ui-router.js"></script>
<script src="__ROOT__/statics/js/angular/loading-bar.js"></script>
<link href='__ROOT__/statics/js/angular/loading-bar.css' rel='stylesheet' />

<script type="text/javascript">
	var cultural = angular.module('cultural', ['ui.router','angular-loading-bar','ngAnimate']);

	cultural.directive('goBack', function($window){
	  return function($scope, $element){
	    $element.on('click', function(){
	      $window.history.back();
	    })
	  }
	});

	cultural.controller("formController", function ($scope, $http) {
        $scope.formData = {};
        $scope.processForm = function() {
 			$http({
		        method  : 'POST',
		        url     : "{:u('user/login/dologin')}",
		        data    : $.param($scope.formData),  // pass in data as strings
		        headers : { 'Content-Type': 'application/x-www-form-urlencoded' }  
		    })
	        .success(function(data) {
	            console.log(data);
	            if (!data.success) {
	               
	            } else {

	                $scope.message = data.message;

	            }
	        });
        };
    });


	cultural.config(function($rootScope,cfpLoadingBarProvider,$stateProvider, $urlRouterProvider,$locationProvider,$httpProvider) {

		$urlRouterProvider.when("", "/")
		.otherwise(function($injector, $location){
			$injector.invoke(['$state', function($state) {
    			window.location = $location['$$absUrl'];
  			}]);
  		});
		// $rootScope.$viewHistory.backView = null;
		$stateProvider
		.state("/", {
			url: "/",
			templateUrl: "/"
		})
		.state("search", {
			url: "/search/index.html",
			templateUrl: "/search/index.html"
		})
		.state("user", {
			url: "/user/:actionName/:tplName.html",
			templateUrl: function ($stateParams){
			    return '/user/' + $stateParams.actionName + '/' + $stateParams.tplName + '.html';
			}
		})
		.state("list", {
			url: "/list/index/id/:listId.html",
			templateUrl: function ($stateParams){
			    return '/list/index/id/' + $stateParams.listId + '.html';
			}
		})
		.state("article", {
			url: "/article/index/id/:articleId.html",
			templateUrl: function ($stateParams){
			    return '/article/index/id/' + $stateParams.articleId + '.html';
			}
		})
		.state("comment", {
			url: "/comment/comment/:tplName.html",
			templateUrl: function ($stateParams){
			    return '/comment/comment/' + $stateParams.tplName + '.html';
			}
		})
		

		cfpLoadingBarProvider.includeSpinner = true;
		$locationProvider.html5Mode(true);
		$httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';
		$httpProvider.defaults.headers.common['X-Requested-With'] = 'application/angularjs';
		
	});

	cultural.run(function($rootScope){
	    $rootScope
	        .$on('$stateChangeStart', 
	            function(event, toState, toParams, fromState, fromParams){ 
	                $("#layout").html("<div class='tf-spin' ng-show='loading'><i class='fa fa-spinner fa-3x fa-spin'></i><p>数据加载中</p></div>");
	        });
	    $rootScope
	        .$on('$stateChangeSuccess',
	            function(event, toState, toParams, fromState, fromParams){ 
	                $("#layout").remove(".tf-spin");
	        });

	});
</script>
<script type="text/javascript">
$(function(){
	$('body').on('touchstart.dropdown', '.dropdown-menu', function (e) { e.stopPropagation(); });
	
	;(function($){
		$.fn.totop=function(opt){
			var scrolling=false;
			return this.each(function(){
				var $this=$(this);
				$(window).scroll(function(){
					if(!scrolling){
						var sd=$(window).scrollTop();
						if(sd>100){
							$this.fadeIn();
						}else{
							$this.fadeOut();
						}
					}
				});
				
				$this.click(function(){
					scrolling=true;
					$('html, body').animate({
						scrollTop : 0
					}, 500,function(){
						scrolling=false;
						$this.fadeOut();
					});
				});
			});
		};
	})(jQuery);
	
	$("#backtotop").totop();
	
});
</script>
